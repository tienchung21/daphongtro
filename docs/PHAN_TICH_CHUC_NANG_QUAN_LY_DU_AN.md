# PH√ÇN T√çCH CH·ª®C NƒÇNG QU·∫¢N L√ù D·ª∞ √ÅN - C√íN THI·∫æU G√å?

**Ng√†y t·∫°o:** 2025-10-16  
**Ph·∫°m vi:** Module Ch·ªß d·ª± √°n - Qu·∫£n l√Ω d·ª± √°n  
**Tham chi·∫øu:** `thue_tro.sql`, `docs/use-cases-v1.2.md`

---

## üìä T·ªîNG QUAN PH√ÇN T√çCH DATABASE

### ‚úÖ C√°c ch·ª©c nƒÉng ƒê√É C√ì ƒë·∫ßy ƒë·ªß trong database

| Ch·ª©c nƒÉng | B·∫£ng li√™n quan | Fields ch√≠nh | Tr·∫°ng th√°i UI |
|-----------|----------------|--------------|---------------|
| **Qu·∫£n l√Ω D·ª± √°n c∆° b·∫£n** | `duan` | `DuAnID`, `TenDuAn`, `DiaChi`, `ViDo`, `KinhDo`, `ChuDuAnID`, `TrangThai` | ‚úÖ Ho√†n ch·ªânh (QuanLyDuAn_v2) |
| **Ph∆∞∆°ng th·ª©c v√†o d·ª± √°n** | `duan` | `YeuCauPheDuyetChu`, `PhuongThucVao` | ‚úÖ C√≥ trong ModalCapNhatDuAn |
| **Qu·∫£n l√Ω Tin ƒëƒÉng** | `tindang` | `TinDangID`, `DuAnID`, `TieuDe`, `MoTa`, `URL`, `TrangThai`, `LyDoTuChoi` | ‚úÖ C√≥ UI (QuanLyTinDang) |
| **Qu·∫£n l√Ω Ph√≤ng** | `phong` | `PhongID`, `DuAnID`, `TenPhong`, `TrangThai`, `GiaChuan`, `DienTichChuan` | ‚úÖ C√≥ backend query |
| **Ph√™ duy·ªát Cu·ªôc h·∫πn** | `cuochen` | `PheDuyetChuDuAn`, `LyDoTuChoi`, `PhuongThucVao`, `ThoiGianPheDuyet` | ‚ùì Ch∆∞a r√µ c√≥ UI ch∆∞a |
| **C·ªçc gi·ªØ ch·ªó/An ninh** | `coc` | `CocID`, `Loai`, `SoTien`, `TTL_Gio`, `TrangThai` | ‚úÖ C√≥ backend query (CocStats) |

### ‚ùå C√°c ch·ª©c nƒÉng CH∆ØA C√ì ho·∫∑c THI·∫æU SOT

#### 1. üö® **Qu·∫£n l√Ω Ch√≠nh s√°ch C·ªçc** (THI·∫æU HO√ÄN TO√ÄN)

**Database:** ‚úÖ B·∫£ng `chinhsachcoc` ƒë√£ c√≥ ƒë·∫ßy ƒë·ªß
```sql
CREATE TABLE `chinhsachcoc` (
  `ChinhSachCocID` int(11) NOT NULL,
  `TenChinhSach` varchar(255) NOT NULL,
  `MoTa` text DEFAULT NULL,
  `ChoPhepCocGiuCho` tinyint(1) NOT NULL DEFAULT 1,
  `TTL_CocGiuCho_Gio` int(11) NOT NULL DEFAULT 48,       -- TTL c·ªçc gi·ªØ ch·ªó (gi·ªù)
  `TyLePhat_CocGiuCho` decimal(5,2) NOT NULL DEFAULT 0.00, -- T·ª∑ l·ªá ph·∫°t (%)
  `ChoPhepCocAnNinh` tinyint(1) NOT NULL DEFAULT 1,
  `SoTienCocAnNinhMacDinh` decimal(15,2) DEFAULT NULL,
  `QuyTacGiaiToa` enum('BanGiao','TheoNgay','Khac') NOT NULL DEFAULT 'BanGiao',
  `HieuLuc` tinyint(1) NOT NULL DEFAULT 1,
  `TaoLuc` datetime DEFAULT current_timestamp(),
  `CapNhatLuc` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**Frontend:** ‚ùå CH∆ØA C√ì UI
- QuanLyDuAn_v2 ch∆∞a c√≥ section hi·ªÉn th·ªã ch√≠nh s√°ch c·ªçc
- Ch∆∞a c√≥ modal t·∫°o/ch·ªânh s·ª≠a ch√≠nh s√°ch c·ªçc
- Ch∆∞a c√≥ dropdown ch·ªçn ch√≠nh s√°ch c·ªçc trong TaoTinDang/ChinhSuaTinDang

**Backend:** ‚ùì Ch∆∞a r√µ c√≥ API CRUD ch√≠nh s√°ch c·ªçc ch∆∞a

**Use Case tham chi·∫øu:** UC-PROJ-03 (Qu·∫£n l√Ω c·ªçc v√† thanh to√°n)

**∆Øu ti√™n:** üî¥ CAO - ·∫¢nh h∆∞·ªüng tr·ª±c ti·∫øp ƒë·∫øn lu·ªìng ƒë·∫∑t c·ªçc

---

#### 2. üö® **L√Ω do Ng∆∞ng ho·∫°t ƒë·ªông (Banned) v√† Y√™u c·∫ßu M·ªü l·∫°i** (THI·∫æU HO√ÄN TO√ÄN)

**Database:** ‚ùå CH∆ØA C√ì fields
- B·∫£ng `duan` thi·∫øu: `LyDoNgungHoatDong`, `NguoiNgungHoatDongID`, `NgungHoatDongLuc`
- Thi·∫øu fields qu·∫£n l√Ω y√™u c·∫ßu m·ªü l·∫°i: `YeuCauMoLai`, `NoiDungGiaiTrinh`, `ThoiGianGuiYeuCau`, `NguoiXuLyYeuCauID`, `ThoiGianXuLyYeuCau`, `LyDoTuChoiMoLai`

**Migration ƒë√£ t·∫°o:** ‚úÖ `migrations/2025_10_16_add_banned_reason_to_duan.sql`

**Frontend:** ‚ùå CH∆ØA C√ì UI
- QuanLyDuAn_v2 hi·ªÉn th·ªã badge "Ng∆∞ng ho·∫°t ƒë·ªông" nh∆∞ng kh√¥ng c√≥ tooltip l√Ω do
- Kh√¥ng c√≥ modal gi·∫£i tr√¨nh/y√™u c·∫ßu m·ªü l·∫°i d·ª± √°n
- Kh√¥ng c√≥ UI cho Operator/Admin x·ª≠ l√Ω y√™u c·∫ßu m·ªü l·∫°i

**Backend:** ‚ùå CH∆ØA C√ì API
- Ch∆∞a c√≥ API banned d·ª± √°n v·ªõi l√Ω do
- Ch∆∞a c√≥ API g·ª≠i y√™u c·∫ßu m·ªü l·∫°i
- Ch∆∞a c√≥ API Operator/Admin duy·ªát/t·ª´ ch·ªëi y√™u c·∫ßu

**Use Case tham chi·∫øu:** UC-OP-04 (Qu·∫£n l√Ω vi ph·∫°m v√† x·ª≠ ph·∫°t)

**∆Øu ti√™n:** üî¥ CAO - Nghi·ªáp v·ª• quan tr·ªçng cho quy·ªÅn qu·∫£n tr·ªã

---

#### 3. ‚ö†Ô∏è **Hi·ªÉn th·ªã L√Ω do T·ª´ ch·ªëi Tin ƒëƒÉng** (THI·∫æU UI)

**Database:** ‚úÖ B·∫£ng `tindang` ƒë√£ c√≥ field `LyDoTuChoi TEXT NULL`

**Frontend:** ‚ùì Ch∆∞a r√µ UI QuanLyTinDang c√≥ hi·ªÉn th·ªã ch∆∞a
- C·∫ßn verify: Chi ti·∫øt tin ƒëƒÉng c√≥ hi·ªÉn th·ªã l√Ω do t·ª´ ch·ªëi kh√¥ng?
- C·∫ßn verify: Modal ch·ªânh s·ª≠a c√≥ editable field n√†y kh√¥ng?

**Backend:** ‚úÖ Backend query ƒë√£ include field n√†y

**Use Case tham chi·∫øu:** UC-PROJ-01 (ƒêƒÉng tin cho thu√™)

**∆Øu ti√™n:** üü° TRUNG B√åNH - UX c·∫£i thi·ªán, kh√¥ng block nghi·ªáp v·ª•

---

#### 4. ‚ö†Ô∏è **Li√™n k·∫øt Tin ƒëƒÉng v·ªõi Ch√≠nh s√°ch C·ªçc** (THI·∫æU UI)

**Database:** ‚úÖ B·∫£ng `tindang` ƒë√£ c√≥ field `ChinhSachCocID INT(11)`

**Frontend:** ‚ùå CH∆ØA C√ì UI
- TaoTinDang ch∆∞a c√≥ dropdown ch·ªçn ch√≠nh s√°ch c·ªçc
- ChinhSuaTinDang ch∆∞a c√≥ dropdown ch·ªçn ch√≠nh s√°ch c·ªçc
- Chi ti·∫øt tin ƒëƒÉng ch∆∞a hi·ªÉn th·ªã th√¥ng tin ch√≠nh s√°ch c·ªçc √°p d·ª•ng

**Backend:** ‚úÖ Backend query ƒë√£ include field n√†y

**Use Case tham chi·∫øu:** UC-PROJ-01 (ƒêƒÉng tin cho thu√™)

**∆Øu ti√™n:** üü° TRUNG B√åNH - Ph·ª• thu·ªôc v√†o ch·ª©c nƒÉng #1 (Qu·∫£n l√Ω ch√≠nh s√°ch c·ªçc)

---

#### 5. ‚ö†Ô∏è **Ph√™ duy·ªát Cu·ªôc h·∫πn t·ª´ Ch·ªß d·ª± √°n** (THI·∫æU UI)

**Database:** ‚úÖ B·∫£ng `cuochen` ƒë√£ c√≥ ƒë·∫ßy ƒë·ªß fields
```sql
`PheDuyetChuDuAn` enum('ChoPheDuyet','DaPheDuyet','TuChoi') DEFAULT NULL 
  COMMENT 'Tr·∫°ng th√°i ph√™ duy·ªát t·ª´ ch·ªß d·ª± √°n (NULL n·∫øu d·ª± √°n kh√¥ng y√™u c·∫ßu ph√™ duy·ªát)',
`LyDoTuChoi` text DEFAULT NULL 
  COMMENT 'L√Ω do t·ª´ ch·ªëi cu·ªôc h·∫πn (n·∫øu PheDuyetChuDuAn = TuChoi)',
`PhuongThucVao` text DEFAULT NULL 
  COMMENT 'Ph∆∞∆°ng th·ª©c v√†o d·ª± √°n cho cu·ªôc h·∫πn n√†y (ghi ƒë√® PhuongThucVao c·ªßa duan n·∫øu c√≥)',
`ThoiGianPheDuyet` datetime DEFAULT NULL 
  COMMENT 'Th·ªùi ƒëi·ªÉm ch·ªß d·ª± √°n ph√™ duy·ªát/t·ª´ ch·ªëi cu·ªôc h·∫πn'
```

**Frontend:** ‚ùì Ch∆∞a r√µ c√≥ UI qu·∫£n l√Ω cu·ªôc h·∫πn ch∆∞a
- C·∫ßn verify: Dashboard c√≥ section "Cu·ªôc h·∫πn ch·ªù ph√™ duy·ªát" kh√¥ng?
- C·∫ßn verify: C√≥ trang qu·∫£n l√Ω cu·ªôc h·∫πn ri√™ng kh√¥ng?

**Backend:** ‚ùì Ch∆∞a r√µ c√≥ API ph√™ duy·ªát/t·ª´ ch·ªëi cu·ªôc h·∫πn ch∆∞a

**Use Case tham chi·∫øu:** UC-PROJ-02 (Qu·∫£n l√Ω cu·ªôc h·∫πn)

**∆Øu ti√™n:** üî¥ CAO - Nghi·ªáp v·ª• ch√≠nh c·ªßa Ch·ªß d·ª± √°n

---

## üìã ROADMAP TRI·ªÇN KHAI

### Phase 1: Nghi·ªáp v·ª• C·ªët l√µi (∆Øu ti√™n CAO) - Sprint 1 (1 tu·∫ßn)

#### Task 1.1: Qu·∫£n l√Ω Ch√≠nh s√°ch C·ªçc
**C√¥ng vi·ªác:**
1. **Backend API:**
   - `GET /api/chu-du-an/chinh-sach-coc` - Danh s√°ch ch√≠nh s√°ch c·ªçc c·ªßa Ch·ªß d·ª± √°n
   - `POST /api/chu-du-an/chinh-sach-coc` - T·∫°o ch√≠nh s√°ch c·ªçc m·ªõi
   - `PUT /api/chu-du-an/chinh-s√°ch-coc/:id` - C·∫≠p nh·∫≠t ch√≠nh s√°ch c·ªçc
   - `DELETE /api/chu-du-an/chinh-sach-coc/:id` - V√¥ hi·ªáu h√≥a ch√≠nh s√°ch (soft delete)

2. **Frontend UI:**
   - Component: `ModalQuanLyChinhSachCoc.jsx`
     - Form t·∫°o/s·ª≠a: T√™n ch√≠nh s√°ch, M√¥ t·∫£, TTL gi·ªØ ch·ªó (gi·ªù), T·ª∑ l·ªá ph·∫°t (%), Quy t·∫Øc gi·∫£i t·ªèa, C·ªçc an ninh m·∫∑c ƒë·ªãnh
     - Validation: TTL > 0, T·ª∑ l·ªá ph·∫°t 0-100%
   - Th√™m section trong expandable row c·ªßa QuanLyDuAn_v2:
     ```jsx
     <div className="cda-detail-section">
       <h4>üìã Ch√≠nh s√°ch C·ªçc</h4>
       {item.ChinhSachCoc?.map(policy => (
         <div className="policy-card">
           <span className="policy-name">{policy.TenChinhSach}</span>
           <span className="policy-ttl">TTL: {policy.TTL_CocGiuCho_Gio}h</span>
           <span className="policy-fine">Ph·∫°t: {policy.TyLePhat_CocGiuCho}%</span>
           <button onClick={() => openEditPolicy(policy.ChinhSachCocID)}>
             <HiOutlinePencil />
           </button>
         </div>
       ))}
       <button className="btn-add-policy" onClick={openCreatePolicy}>
         + Th√™m ch√≠nh s√°ch c·ªçc
       </button>
     </div>
     ```

3. **Backend Model:**
   - File: `server/models/ChinhSachCocModel.js`
   - Methods:
     ```javascript
     layDanhSach(chuDuAnID) // L·∫•y danh s√°ch ch√≠nh s√°ch c·ªßa Ch·ªß d·ª± √°n
     taoMoi({ TenChinhSach, MoTa, TTL_CocGiuCho_Gio, ... })
     capNhat(chinhSachCocID, data)
     voHieuHoa(chinhSachCocID) // Soft delete (HieuLuc = 0)
     ```

**Estimate:** 3 ng√†y (1 backend, 2 frontend)

---

#### Task 1.2: Banned D·ª± √°n v·ªõi L√Ω do
**C√¥ng vi·ªác:**
1. **Ch·∫°y Migration:**
   ```bash
   # PowerShell
   cd "d:\Vo Nguyen Hoanh Hop_J Liff\xampp\htdocs\daphongtro"
   # Import migration v√†o MySQL
   mysql -u root -p thue_tro < migrations/2025_10_16_add_banned_reason_to_duan.sql
   ```

2. **Backend API:**
   - `PUT /api/operator/du-an/:id/banned` - Operator/Admin banned d·ª± √°n
     - Body: `{ LyDoNgungHoatDong: string, NguoiNgungHoatDongID: int }`
     - Response: Ghi audit log, c·∫≠p nh·∫≠t TrangThai='NgungHoatDong'
   - `POST /api/chu-du-an/du-an/:id/yeu-cau-mo-lai` - Ch·ªß d·ª± √°n g·ª≠i y√™u c·∫ßu m·ªü l·∫°i
     - Body: `{ NoiDungGiaiTrinh: string }`
     - Response: C·∫≠p nh·∫≠t YeuCauMoLai='DangXuLy'
   - `PUT /api/operator/du-an/:id/xu-ly-yeu-cau` - Operator/Admin x·ª≠ l√Ω y√™u c·∫ßu
     - Body: `{ KetQua: 'ChapNhan'|'TuChoi', LyDoTuChoiMoLai?: string }`

3. **Frontend UI:**
   - Component: `ModalYeuCauMoLaiDuAn.jsx`
     - Textarea: N·ªôi dung gi·∫£i tr√¨nh (required, min 50 k√Ω t·ª±)
     - Upload: ƒê√≠nh k√®m b·∫±ng ch·ª©ng (optional, max 5 files)
   - C·∫≠p nh·∫≠t QuanLyDuAn_v2.jsx:
     ```jsx
     {/* Badge cho d·ª± √°n b·ªã banned */}
     {item.TrangThai === 'NgungHoatDong' && (
       <Tooltip content={item.LyDoNgungHoatDong}>
         <span className="badge badge-banned">
           <HiOutlineExclamationTriangle />
           Ng∆∞ng ho·∫°t ƒë·ªông
         </span>
       </Tooltip>
     )}
     
     {/* Expandable row - Section l√Ω do banned */}
     {item.TrangThai === 'NgungHoatDong' && (
       <div className="cda-detail-section banned-info">
         <h4>‚ö†Ô∏è Th√¥ng tin Ng∆∞ng ho·∫°t ƒë·ªông</h4>
         <div className="banned-details">
           <p><strong>L√Ω do:</strong> {item.LyDoNgungHoatDong}</p>
           <p><strong>Ng∆∞·ªùi x·ª≠ l√Ω:</strong> {item.NguoiNgungHoatDong?.TenDayDu}</p>
           <p><strong>Th·ªùi gian:</strong> {formatDateTime(item.NgungHoatDongLuc)}</p>
         </div>
         
         {/* N√∫t y√™u c·∫ßu m·ªü l·∫°i */}
         {!item.YeuCauMoLai || item.YeuCauMoLai === 'TuChoi' ? (
           <button 
             className="btn-request-reopen" 
             onClick={() => openModalYeuCauMoLai(item.DuAnID)}
           >
             <HiOutlineArrowPath />
             G·ª≠i y√™u c·∫ßu m·ªü l·∫°i
           </button>
         ) : (
           <div className="request-status">
             {item.YeuCauMoLai === 'DangXuLy' && (
               <span className="badge badge-warning">
                 <HiOutlineClock />
                 ƒêang x·ª≠ l√Ω y√™u c·∫ßu
               </span>
             )}
             {item.YeuCauMoLai === 'ChapNhan' && (
               <span className="badge badge-success">
                 <HiOutlineCheckCircle />
                 Y√™u c·∫ßu ƒë∆∞·ª£c ch·∫•p nh·∫≠n
               </span>
             )}
             {item.YeuCauMoLai === 'TuChoi' && (
               <div>
                 <span className="badge badge-danger">
                   <HiOutlineXCircle />
                   Y√™u c·∫ßu b·ªã t·ª´ ch·ªëi
                 </span>
                 <p className="reason-text">{item.LyDoTuChoiMoLai}</p>
               </div>
             )}
           </div>
         )}
       </div>
     )}
     ```

4. **Backend Model Update:**
   - File: `server/models/ChuDuAnModel.js`
   - Update method `layDanhSachDuAn()` ƒë·ªÉ JOIN th√™m fields m·ªõi:
     ```javascript
     // Line ~650 (trong method layDanhSachDuAn)
     const query = `
       SELECT 
         d.DuAnID, d.TenDuAn, d.DiaChi, d.TrangThai,
         d.LyDoNgungHoatDong, d.NguoiNgungHoatDongID, d.NgungHoatDongLuc,
         d.YeuCauMoLai, d.NoiDungGiaiTrinh, d.ThoiGianGuiYeuCau,
         d.LyDoTuChoiMoLai,
         nd_banned.TenDayDu AS NguoiNgungHoatDong_TenDayDu,
         ... (existing fields)
       FROM duan d
       LEFT JOIN nguoidung nd_banned ON d.NguoiNgungHoatDongID = nd_banned.NguoiDungID
       ... (existing joins)
     `;
     ```

**Estimate:** 3 ng√†y (1 migration + backend, 2 frontend)

---

#### Task 1.3: Ph√™ duy·ªát Cu·ªôc h·∫πn
**C√¥ng vi·ªác:**
1. **Verify backend API t·ªìn t·∫°i:**
   - Check file: `server/routes/cuocHenRoutes.js` ho·∫∑c `chuDuAnRoutes.js`
   - C·∫ßn c√≥: `PUT /api/chu-du-an/cuoc-hen/:id/phe-duyet`

2. **T·∫°o trang Qu·∫£n l√Ω Cu·ªôc h·∫πn:**
   - File: `client/src/pages/ChuDuAn/QuanLyCuocHen.jsx`
   - UI g·ªìm:
     - Tabs: Ch·ªù ph√™ duy·ªát | ƒê√£ ph√™ duy·ªát | ƒê√£ t·ª´ ch·ªëi | T·∫•t c·∫£
     - Table: Kh√°ch h√†ng, Ph√≤ng, Th·ªùi gian h·∫πn, Tr·∫°ng th√°i, H√†nh ƒë·ªông
     - Modal ph√™ duy·ªát: Ch·ªçn "Ch·∫•p nh·∫≠n" ho·∫∑c "T·ª´ ch·ªëi" + L√Ω do (n·∫øu t·ª´ ch·ªëi) + Ph∆∞∆°ng th·ª©c v√†o (n·∫øu ch·∫•p nh·∫≠n)

3. **Th√™m route v√†o App.jsx:**
   ```jsx
   import QuanLyCuocHen from './pages/ChuDuAn/QuanLyCuocHen';
   // ...
   <Route path='/chu-du-an/cuoc-hen' element={<QuanLyCuocHen />} />
   ```

4. **Update Navigation:**
   - File: `client/src/components/ChuDuAn/NavigationChuDuAn.jsx`
   - Th√™m menu item:
     ```jsx
     {
       to: '/chu-du-an/cuoc-hen',
       icon: <HiOutlineCalendar />,
       label: 'Cu·ªôc h·∫πn',
       badge: countCuocHenChoDuyet // Real-time count t·ª´ API
     }
     ```

**Estimate:** 2 ng√†y (verify backend + frontend UI)

---

### Phase 2: UX Improvements (∆Øu ti√™n TRUNG B√åNH) - Sprint 2 (1 tu·∫ßn)

#### Task 2.1: Hi·ªÉn th·ªã L√Ω do T·ª´ ch·ªëi Tin ƒëƒÉng
**C√¥ng vi·ªác:**
1. Verify UI hi·ªán t·∫°i:
   ```bash
   # T√¨m t·∫•t c·∫£ file li√™n quan
   grep -r "LyDoTuChoi" client/src/pages/ChuDuAn/
   ```

2. N·∫øu ch∆∞a c√≥, th√™m v√†o:
   - `QuanLyTinDang.jsx`: Expandable row hi·ªÉn th·ªã l√Ω do t·ª´ ch·ªëi
   - `ChiTietTinDang.jsx`: Alert box m√†u ƒë·ªè hi·ªÉn th·ªã l√Ω do t·ª´ ch·ªëi
   - `ChinhSuaTinDang.jsx`: Readonly field hi·ªÉn th·ªã l√Ω do (kh√¥ng cho s·ª≠a)

**Estimate:** 1 ng√†y

---

#### Task 2.2: Li√™n k·∫øt Tin ƒëƒÉng v·ªõi Ch√≠nh s√°ch C·ªçc
**C√¥ng vi·ªác:**
1. **TaoTinDang.jsx:**
   - Th√™m dropdown ch·ªçn ch√≠nh s√°ch c·ªçc:
     ```jsx
     <div className="form-group">
       <label>Ch√≠nh s√°ch C·ªçc <span className="required">*</span></label>
       <select 
         name="ChinhSachCocID" 
         value={formData.ChinhSachCocID}
         onChange={handleChange}
         required
       >
         <option value="">-- Ch·ªçn ch√≠nh s√°ch --</option>
         {danhSachChinhSachCoc.map(policy => (
           <option key={policy.ChinhSachCocID} value={policy.ChinhSachCocID}>
             {policy.TenChinhSach} (TTL: {policy.TTL_CocGiuCho_Gio}h, Ph·∫°t: {policy.TyLePhat_CocGiuCho}%)
           </option>
         ))}
       </select>
     </div>
     ```

2. **ChinhSuaTinDang.jsx:** T∆∞∆°ng t·ª± TaoTinDang

3. **ChiTietTinDang.jsx:**
   - Hi·ªÉn th·ªã th√¥ng tin ch√≠nh s√°ch c·ªçc √°p d·ª•ng:
     ```jsx
     <div className="tin-dang-section">
       <h3>üìã Ch√≠nh s√°ch C·ªçc √°p d·ª•ng</h3>
       <div className="policy-info-card">
         <p><strong>T√™n:</strong> {tinDang.ChinhSachCoc.TenChinhSach}</p>
         <p><strong>TTL gi·ªØ ch·ªó:</strong> {tinDang.ChinhSachCoc.TTL_CocGiuCho_Gio} gi·ªù</p>
         <p><strong>T·ª∑ l·ªá ph·∫°t:</strong> {tinDang.ChinhSachCoc.TyLePhat_CocGiuCho}%</p>
         <p><strong>Quy t·∫Øc gi·∫£i t·ªèa:</strong> {formatQuyTacGiaiToa(tinDang.ChinhSachCoc.QuyTacGiaiToa)}</p>
       </div>
     </div>
     ```

**Estimate:** 2 ng√†y

---

## üìä T·ªîNG K·∫æT CHECKLIST

### Database Schema
- ‚úÖ B·∫£ng `chinhsachcoc` - ƒê√£ c√≥ ƒë·∫ßy ƒë·ªß
- ‚úÖ B·∫£ng `tindang.ChinhSachCocID` - ƒê√£ c√≥ field
- ‚úÖ B·∫£ng `tindang.LyDoTuChoi` - ƒê√£ c√≥ field
- ‚úÖ B·∫£ng `cuochen` - ƒê√£ c√≥ ƒë·∫ßy ƒë·ªß fields ph√™ duy·ªát
- ‚ùå B·∫£ng `duan` - Thi·∫øu fields banned/y√™u c·∫ßu m·ªü l·∫°i ‚Üí Migration ƒë√£ t·∫°o

### Backend APIs
- ‚ùå CRUD Ch√≠nh s√°ch C·ªçc
- ‚ùå Banned d·ª± √°n v·ªõi l√Ω do
- ‚ùå Y√™u c·∫ßu m·ªü l·∫°i d·ª± √°n
- ‚ùå X·ª≠ l√Ω y√™u c·∫ßu m·ªü l·∫°i (Operator/Admin)
- ‚ùì Ph√™ duy·ªát/T·ª´ ch·ªëi cu·ªôc h·∫πn (c·∫ßn verify)

### Frontend Components
- ‚ùå `ModalQuanLyChinhSachCoc.jsx`
- ‚ùå `ModalYeuCauMoLaiDuAn.jsx`
- ‚ùå `QuanLyCuocHen.jsx` (trang ri√™ng)
- ‚ùå Expandable row section: Ch√≠nh s√°ch C·ªçc
- ‚ùå Expandable row section: L√Ω do banned + Y√™u c·∫ßu m·ªü l·∫°i
- ‚ùì Dropdown ch·ªçn ch√≠nh s√°ch c·ªçc trong TaoTinDang/ChinhSuaTinDang
- ‚ùì Hi·ªÉn th·ªã l√Ω do t·ª´ ch·ªëi tin ƒëƒÉng

### Documentation
- ‚úÖ Migration SQL ƒë√£ t·∫°o
- ‚úÖ File ph√¢n t√≠ch n√†y
- ‚ùå API documentation cho endpoints m·ªõi
- ‚ùå Update `docs/use-cases-v1.2.md` v·ªõi workflows m·ªõi

---

## üéØ ESTIMATE T·ªîNG

| Phase | Tasks | Estimate | Priority |
|-------|-------|----------|----------|
| **Phase 1** | Qu·∫£n l√Ω Ch√≠nh s√°ch C·ªçc + Banned + Cu·ªôc h·∫πn | 8 ng√†y | üî¥ CAO |
| **Phase 2** | UX improvements (L√Ω do t·ª´ ch·ªëi, Li√™n k·∫øt c·ªçc) | 3 ng√†y | üü° TRUNG B√åNH |
| **Total** | | **11 ng√†y** (~2 sprints) | |

**L∆∞u √Ω:** Estimate tr√™n gi·∫£ ƒë·ªãnh 1 developer full-time, ch∆∞a t√≠nh time testing v√† bug fixing (th∆∞·ªùng th√™m 20-30%).

---

## üìö THAM CHI·∫æU

- **Use Cases:** `docs/use-cases-v1.2.md`
- **Database Schema:** `thue_tro.sql`
- **Migration:** `migrations/2025_10_16_add_banned_reason_to_duan.sql`
- **Existing UI:** `client/src/pages/ChuDuAn/QuanLyDuAn_v2.jsx`, `QuanLyDuAn_v2.css`
- **Design System:** `client/src/styles/ChuDuAnDesignSystem.css`
